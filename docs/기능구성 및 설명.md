# ROIMSG 기능구성 및 설명

## 목차
1. [기능 개요](#1-기능-개요)
2. [인증 및 사용자 관리](#2-인증-및-사용자-관리)
3. [메시징 시스템](#3-메시징-시스템)
4. [게시판](#4-게시판)
5. [자료실](#5-자료실)
6. [대시보드](#6-대시보드)
7. [공통 기능](#7-공통-기능)
8. [관리자 기능](#8-관리자-기능)

---

## 1. 기능 개요

### 1.1. 모듈 구성도

```
ROIMSG System
│
├── 인증 및 사용자 관리 (Auth & User Management)
│   ├── Google OAuth 로그인
│   ├── 회원 가입 및 프로필 관리
│   └── 권한 관리
│
├── 메시징 시스템 (Messaging)
│   ├── 1:1 채팅
│   ├── 그룹 채팅
│   ├── 쪽지 시스템
│   └── 실시간 알림
│
├── 게시판 (Board)
│   ├── 게시글 관리
│   ├── 댓글 시스템
│   ├── 태그 및 검색
│   └── 파일 첨부
│
├── 자료실 (File Repository)
│   ├── 파일 업로드/다운로드
│   ├── 썸네일 및 미리보기
│   └── 파일 관리
│
├── 대시보드 (Dashboard)
│   ├── 위젯 구성
│   ├── 실시간 통계
│   └── 사용자 정의 레이아웃
│
└── 공통 기능 (Common)
    ├── 다국어 지원
    ├── 접근성 지원
    └── 로깅 및 모니터링
```

---

## 2. 인증 및 사용자 관리

### 2.1. Auth Service

#### 2.1.1. Google OAuth 로그인

**기능 설명:**
- Google 계정을 통한 간편 로그인
- 사용자 정보 자동 수신 (이름, 이메일, 프로필 사진)
- 최초 로그인 시 회원 가입 여부 확인

**사용자 플로우:**
```
1. 사용자가 "Google로 로그인" 버튼 클릭
2. Google 인증 페이지로 리다이렉트
3. 사용자가 Google 계정으로 인증
4. Authorization Code 반환
5. 서버에서 Code를 Access Token으로 교환
6. Google API로 사용자 정보 조회
7. 기존 사용자 확인:
   - 존재하면: JWT 토큰 발급 (로그인 완료)
   - 없으면: 회원가입 토큰 발급 (추가 정보 입력 필요)
```

**API 엔드포인트:**
- `POST /auth/google/login` - Google 로그인
- `POST /auth/google/signup` - Google 회원가입
- `POST /auth/refresh` - 토큰 갱신
- `POST /auth/logout` - 로그아웃
- `GET /auth/me` - 현재 사용자 정보 조회

**요청 예시:**
```json
POST /auth/google/login
{
  "code": "4/0AY0e-g7...",
  "tenantId": "550e8400-e29b-41d4-a716-446655440000"
}
```

**응답 예시 (기존 사용자):**
```json
{
  "authenticated": true,
  "needSignup": false,
  "auth": {
    "accessToken": "eyJhbGciOiJIUzI1NiIs...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIs...",
    "expiresIn": 86400,
    "user": {
      "id": "user-uuid",
      "email": "user@example.com",
      "name": "홍길동",
      "profileImageUrl": "https://..."
    }
  }
}
```

**응답 예시 (신규 사용자):**
```json
{
  "authenticated": false,
  "needSignup": true,
  "signupToken": "eyJhbGciOiJIUzI1NiIs...",
  "profile": {
    "email": "newuser@example.com",
    "name": "김철수",
    "picture": "https://..."
  }
}
```

#### 2.1.2. JWT 토큰 관리

**토큰 종류:**
1. **Access Token**
   - 유효기간: 1시간
   - 용도: API 요청 인증
   - 저장 위치: LocalStorage 또는 Memory

2. **Refresh Token**
   - 유효기간: 7일
   - 용도: Access Token 재발급
   - 저장 위치: HttpOnly Cookie (권장)

3. **Signup Token**
   - 유효기간: 10분
   - 용도: 회원가입 프로세스
   - 일회용 토큰

**토큰 갱신 플로우:**
```
1. Access Token 만료 감지
2. Refresh Token으로 갱신 요청
3. Refresh Token 유효성 검증
4. 새로운 Access Token 및 Refresh Token 발급
5. 클라이언트에서 토큰 업데이트
```

### 2.2. User Service

#### 2.2.1. 사용자 프로필 관리

**기능:**
- 사용자 정보 조회 및 수정
- 프로필 이미지 업로드 및 변경
- 추가 정보 관리 (전화번호, 주소)
- 회원 탈퇴

**API 엔드포인트:**
- `GET /users/{userId}` - 사용자 조회
- `PUT /users/{userId}` - 사용자 정보 수정
- `POST /users/{userId}/profile-image` - 프로필 이미지 업로드
- `DELETE /users/{userId}` - 회원 탈퇴
- `GET /users/search` - 사용자 검색

**사용자 정보 수정 요청:**
```json
PUT /users/{userId}
{
  "name": "홍길동",
  "phoneNumber": "010-1234-5678",
  "address": "서울시 강남구..."
}
```

#### 2.2.2. 사용자 검색

**검색 기능:**
- 이름으로 검색
- 이메일로 검색
- 테넌트 내 사용자만 검색 가능

**검색 요청:**
```json
GET /users/search?q=홍길동&page=0&size=10
```

**검색 응답:**
```json
{
  "content": [
    {
      "id": "user-uuid",
      "name": "홍길동",
      "email": "hong@example.com",
      "profileImageUrl": "https://..."
    }
  ],
  "totalElements": 1,
  "totalPages": 1,
  "size": 10,
  "number": 0
}
```

---

## 3. 메시징 시스템

### 3.1. Message Service

#### 3.1.1. 1:1 채팅

**기능 설명:**
- 두 사용자 간 실시간 채팅
- 메시지 전송 및 수신
- 읽음 상태 표시
- 파일 첨부 지원

**채팅 플로우:**
```
1. 채팅방 생성 또는 기존 채팅방 조회
2. WebSocket 연결
3. 채팅방 구독
4. 메시지 전송/수신
5. 읽음 상태 업데이트
```

**API 엔드포인트:**
- `POST /messages/rooms` - 채팅방 생성
- `GET /messages/rooms` - 채팅방 목록 조회
- `GET /messages/rooms/{roomId}` - 채팅방 상세 조회
- `GET /messages/rooms/{roomId}/messages` - 메시지 목록 조회
- `POST /messages/rooms/{roomId}/messages` - 메시지 전송 (REST)
- `WS /app/chat` - 메시지 전송 (WebSocket)
- `WS /topic/room/{roomId}` - 메시지 수신 (WebSocket)

**채팅방 생성:**
```json
POST /messages/rooms
{
  "type": "DIRECT",
  "participantIds": ["user-uuid-1", "user-uuid-2"]
}
```

**메시지 전송 (WebSocket):**
```javascript
stompClient.send("/app/chat", {}, JSON.stringify({
  roomId: "room-uuid",
  content: "안녕하세요!",
  type: "TEXT"
}));
```

**메시지 수신 (WebSocket):**
```javascript
stompClient.subscribe("/topic/room/" + roomId, (message) => {
  const msg = JSON.parse(message.body);
  console.log(msg);
});
```

#### 3.1.2. 그룹 채팅 (1:N)

**기능 설명:**
- 다수의 사용자가 참여하는 채팅방
- 채팅방 생성 및 초대
- 참여자 추가/제거
- 채팅방 이름 설정

**그룹 채팅방 생성:**
```json
POST /messages/rooms
{
  "type": "GROUP",
  "name": "프로젝트 팀 채팅",
  "participantIds": ["user-1", "user-2", "user-3", "user-4"]
}
```

**참여자 추가:**
```json
POST /messages/rooms/{roomId}/members
{
  "userIds": ["user-5", "user-6"]
}
```

#### 3.1.3. 쪽지 시스템

**기능 설명:**
- 비실시간 메시지 전송
- 1:1 쪽지 및 1:N 쪽지 (그룹 쪽지)
- 읽음/읽지 않음 상태 관리
- 쪽지함 (받은 쪽지, 보낸 쪽지)

**API 엔드포인트:**
- `POST /messages/direct` - 쪽지 전송
- `GET /messages/direct/inbox` - 받은 쪽지함
- `GET /messages/direct/sent` - 보낸 쪽지함
- `PUT /messages/direct/{messageId}/read` - 읽음 처리
- `DELETE /messages/direct/{messageId}` - 쪽지 삭제

**쪽지 전송:**
```json
POST /messages/direct
{
  "recipientIds": ["user-uuid-1", "user-uuid-2"],
  "subject": "회의 안내",
  "content": "내일 오후 2시 회의실에서 회의가 있습니다.",
  "attachments": ["file-uuid-1", "file-uuid-2"]
}
```

#### 3.1.4. 실시간 알림

**알림 유형:**
- 새 메시지 알림
- 멘션 알림 (@사용자)
- 채팅방 초대 알림
- 시스템 알림

**WebSocket 알림 구독:**
```javascript
// 사용자별 알림 채널
stompClient.subscribe("/user/queue/notifications", (notification) => {
  const noti = JSON.parse(notification.body);
  showNotification(noti);
});
```

**알림 데이터 구조:**
```json
{
  "id": "notification-uuid",
  "type": "NEW_MESSAGE",
  "title": "새 메시지",
  "content": "홍길동님이 메시지를 보냈습니다.",
  "link": "/messages/rooms/room-uuid",
  "isRead": false,
  "createdAt": "2025-10-14T12:00:00Z"
}
```

---

## 4. 게시판

### 4.1. Board Service

#### 4.1.1. 게시글 관리

**기능:**
- 게시글 작성, 수정, 삭제
- 게시글 조회 (조회수 증가)
- 공지사항 등록 (관리자)
- 비밀글 설정
- 답글 작성

**API 엔드포인트:**
- `GET /boards` - 게시판 목록
- `GET /boards/{boardId}/posts` - 게시글 목록
- `GET /boards/{boardId}/posts/{postId}` - 게시글 상세 조회
- `POST /boards/{boardId}/posts` - 게시글 작성
- `PUT /boards/{boardId}/posts/{postId}` - 게시글 수정
- `DELETE /boards/{boardId}/posts/{postId}` - 게시글 삭제
- `POST /boards/{boardId}/posts/{postId}/reply` - 답글 작성

**게시글 작성:**
```json
POST /boards/{boardId}/posts
{
  "title": "안녕하세요",
  "content": "첫 게시글입니다.",
  "isSecret": false,
  "isNotice": false,
  "tags": ["인사", "소개"],
  "attachments": ["file-uuid-1", "file-uuid-2"]
}
```

**게시글 목록 조회:**
```json
GET /boards/{boardId}/posts?page=0&size=20&sort=createdAt,desc

응답:
{
  "content": [
    {
      "id": "post-uuid",
      "title": "게시글 제목",
      "authorName": "홍길동",
      "viewCount": 42,
      "likeCount": 5,
      "commentCount": 3,
      "isNotice": false,
      "createdAt": "2025-10-14T12:00:00Z"
    }
  ],
  "totalElements": 100,
  "totalPages": 5,
  "size": 20,
  "number": 0
}
```

#### 4.1.2. 댓글 시스템

**기능:**
- 댓글 작성, 수정, 삭제
- 대댓글 (답글) 작성
- 비밀 댓글
- 댓글 좋아요/싫어요

**API 엔드포인트:**
- `POST /boards/{boardId}/posts/{postId}/comments` - 댓글 작성
- `PUT /boards/{boardId}/posts/{postId}/comments/{commentId}` - 댓글 수정
- `DELETE /boards/{boardId}/posts/{postId}/comments/{commentId}` - 댓글 삭제
- `POST /boards/{boardId}/posts/{postId}/comments/{commentId}/reply` - 대댓글 작성

**댓글 작성:**
```json
POST /boards/{boardId}/posts/{postId}/comments
{
  "content": "좋은 글 감사합니다!",
  "isSecret": false,
  "parentCommentId": null
}
```

#### 4.1.3. 좋아요/싫어요

**기능:**
- 게시글 좋아요/싫어요
- 댓글 좋아요/싫어요
- 중복 방지 (사용자당 1회)

**API 엔드포인트:**
- `POST /boards/{boardId}/posts/{postId}/like` - 좋아요
- `DELETE /boards/{boardId}/posts/{postId}/like` - 좋아요 취소
- `POST /boards/{boardId}/posts/{postId}/dislike` - 싫어요
- `DELETE /boards/{boardId}/posts/{postId}/dislike` - 싫어요 취소

#### 4.1.4. 태그 시스템

**기능:**
- 게시글에 태그 추가
- 태그로 검색
- 인기 태그 조회

**태그 검색:**
```json
GET /boards/{boardId}/posts?tags=공지,중요&page=0&size=20
```

**인기 태그 조회:**
```json
GET /boards/{boardId}/tags/popular?limit=10

응답:
[
  { "name": "공지", "count": 45 },
  { "name": "질문", "count": 38 },
  { "name": "정보", "count": 27 }
]
```

#### 4.1.5. 검색 및 필터링

**검색 필터:**
- 제목으로 검색
- 내용으로 검색
- 작성자로 검색
- 태그로 검색
- 기간으로 검색
- 공지사항 필터

**검색 요청:**
```json
GET /boards/{boardId}/posts/search?q=검색어&searchType=TITLE_AND_CONTENT&startDate=2025-10-01&endDate=2025-10-14&page=0&size=20
```

#### 4.1.6. 파일 첨부

**기능:**
- 게시글에 다중 파일 첨부
- 파일 일괄 다운로드
- 이미지 본문 삽입

**파일 첨부 플로우:**
```
1. 파일 업로드 API 호출 (File Service)
2. 파일 UUID 반환
3. 게시글 작성 시 파일 UUID 포함
4. 게시글과 파일 연결
```

---

## 5. 자료실

### 5.1. File Service

#### 5.1.1. 파일 업로드/다운로드

**기능:**
- 파일 업로드 (멀티파트 폼)
- 파일 다운로드
- 대용량 파일 지원 (청크 업로드)
- 파일 타입 제한
- 바이러스 검사 (선택사항)

**API 엔드포인트:**
- `POST /files/upload` - 파일 업로드
- `GET /files/{fileId}/download` - 파일 다운로드
- `GET /files/{fileId}/info` - 파일 정보 조회
- `DELETE /files/{fileId}` - 파일 삭제
- `POST /files/batch-download` - 일괄 다운로드

**파일 업로드:**
```javascript
const formData = new FormData();
formData.append('file', fileBlob);
formData.append('category', 'DOCUMENT');
formData.append('description', '파일 설명');

axios.post('/files/upload', formData, {
  headers: {
    'Content-Type': 'multipart/form-data'
  }
});
```

**파일 업로드 응답:**
```json
{
  "fileId": "file-uuid",
  "fileName": "document.pdf",
  "fileSize": 1048576,
  "mimeType": "application/pdf",
  "uploadedAt": "2025-10-14T12:00:00Z",
  "url": "/files/file-uuid/download"
}
```

#### 5.1.2. 썸네일 생성

**기능:**
- 이미지 파일 썸네일 자동 생성
- 다양한 크기 지원 (small, medium, large)
- 이미지 최적화

**썸네일 조회:**
```json
GET /files/{fileId}/thumbnail?size=medium
```

**썸네일 크기:**
- small: 100x100
- medium: 300x300
- large: 600x600

#### 5.1.3. PDF 미리보기

**기능:**
- PDF 파일 온라인 미리보기
- 페이지별 렌더링
- PDF.js 라이브러리 활용

**미리보기 URL:**
```
GET /files/{fileId}/preview
```

#### 5.1.4. 파일 관리

**기능:**
- 파일 목록 조회
- 파일 검색 (파일명, 확장자, 날짜)
- 파일 분류 (카테고리)
- 파일 공유 링크 생성

**파일 목록 조회:**
```json
GET /files?category=DOCUMENT&extension=pdf&page=0&size=20

응답:
{
  "content": [
    {
      "fileId": "file-uuid",
      "fileName": "document.pdf",
      "fileSize": 1048576,
      "mimeType": "application/pdf",
      "uploaderName": "홍길동",
      "uploadedAt": "2025-10-14T12:00:00Z"
    }
  ],
  "totalElements": 50,
  "totalPages": 3
}
```

#### 5.1.5. 일괄 다운로드

**기능:**
- 여러 파일 선택하여 ZIP으로 다운로드
- 폴더 전체 다운로드

**일괄 다운로드 요청:**
```json
POST /files/batch-download
{
  "fileIds": ["file-uuid-1", "file-uuid-2", "file-uuid-3"],
  "zipFileName": "다운로드.zip"
}
```

---

## 6. 대시보드

### 6.1. Dashboard Service

#### 6.1.1. 위젯 시스템

**위젯 종류:**
1. **통계 위젯**
   - 읽지 않은 메시지 수
   - 새 게시글 수
   - 오늘의 방문자 수

2. **최근 활동 위젯**
   - 최근 메시지
   - 최근 게시글
   - 최근 댓글

3. **차트 위젯**
   - 일별 메시지 통계
   - 월별 게시글 통계
   - 사용자 활동 차트

4. **캘린더 위젯**
   - 일정 표시
   - 이벤트 알림

5. **할일 목록 위젯**
   - 개인 할일
   - 프로젝트 할일

**API 엔드포인트:**
- `GET /dashboard` - 대시보드 구성 조회
- `POST /dashboard/widgets` - 위젯 추가
- `PUT /dashboard/widgets/{widgetId}` - 위젯 수정
- `DELETE /dashboard/widgets/{widgetId}` - 위젯 삭제
- `PUT /dashboard/layout` - 레이아웃 저장

**위젯 추가:**
```json
POST /dashboard/widgets
{
  "type": "RECENT_MESSAGES",
  "title": "최근 메시지",
  "position": {
    "x": 0,
    "y": 0,
    "width": 4,
    "height": 2
  },
  "config": {
    "limit": 5,
    "showAvatar": true
  }
}
```

#### 6.1.2. 레이아웃 관리

**기능:**
- 드래그 앤 드롭으로 위젯 배치
- 위젯 크기 조정
- 반응형 레이아웃 (PC/모바일)
- 레이아웃 저장 및 복원

**레이아웃 저장:**
```json
PUT /dashboard/layout
{
  "widgets": [
    {
      "widgetId": "widget-uuid-1",
      "position": { "x": 0, "y": 0, "width": 4, "height": 2 }
    },
    {
      "widgetId": "widget-uuid-2",
      "position": { "x": 4, "y": 0, "width": 4, "height": 2 }
    }
  ]
}
```

#### 6.1.3. 실시간 데이터

**기능:**
- 위젯 데이터 자동 갱신
- WebSocket을 통한 실시간 업데이트
- 사용자 정의 갱신 주기

---

## 7. 공통 기능

### 7.1. 다국어 지원 (i18n)

**지원 언어:**
- 한국어 (ko)
- 영어 (en)

**기능:**
- 런타임 언어 전환
- 날짜/시간 형식 지역화
- 숫자 형식 지역화

**언어 전환:**
```javascript
// Vue I18n 사용
import { useI18n } from 'vue-i18n';

const { locale, t } = useI18n();

// 언어 변경
locale.value = 'en';

// 번역 사용
const message = t('common.welcome');
```

**번역 파일 구조:**
```json
// locales/ko.json
{
  "common": {
    "welcome": "환영합니다",
    "login": "로그인",
    "logout": "로그아웃"
  },
  "message": {
    "newMessage": "새 메시지",
    "sendMessage": "메시지 전송"
  }
}
```

### 7.2. 웹 접근성 (Accessibility)

**준수 기준:**
- KWCAG 2.2 AA 레벨
- WCAG 2.1 AA 레벨

**주요 기능:**
1. **키보드 접근성**
   - 모든 기능 키보드로 접근 가능
   - Tab 키 네비게이션
   - 단축키 지원

2. **스크린 리더 지원**
   - ARIA 속성 사용
   - 의미 있는 라벨
   - 상태 변화 알림

3. **시각적 접근성**
   - 충분한 색상 대비 (4.5:1 이상)
   - 확대/축소 지원
   - 고대비 모드

4. **인지적 접근성**
   - 명확한 UI
   - 일관된 네비게이션
   - 에러 메시지 명확화

### 7.3. 알림 시스템

**알림 유형:**
- 브라우저 푸시 알림
- 인앱 알림
- 이메일 알림 (선택사항)

**알림 설정:**
```json
PUT /users/{userId}/notification-settings
{
  "emailNotification": true,
  "pushNotification": true,
  "inAppNotification": true,
  "notificationTypes": {
    "NEW_MESSAGE": true,
    "NEW_COMMENT": true,
    "MENTION": true,
    "SYSTEM": false
  }
}
```

### 7.4. 검색 기능

**전역 검색:**
- 게시글 검색
- 사용자 검색
- 파일 검색
- 메시지 검색 (제목만)

**검색 요청:**
```json
GET /search?q=검색어&type=ALL&page=0&size=20

응답:
{
  "posts": [...],
  "users": [...],
  "files": [...],
  "totalResults": 42
}
```

---

## 8. 관리자 기능

### 8.1. 사용자 관리

**기능:**
- 전체 사용자 목록 조회
- 사용자 상세 정보 조회
- 사용자 활성화/비활성화
- 사용자 권한 관리
- 사용자 강제 로그아웃

**API 엔드포인트:**
- `GET /admin/users` - 사용자 목록
- `PUT /admin/users/{userId}/activate` - 활성화
- `PUT /admin/users/{userId}/deactivate` - 비활성화
- `PUT /admin/users/{userId}/roles` - 권한 변경

### 8.2. 콘텐츠 관리

**기능:**
- 게시글 관리 (수정, 삭제, 공지 전환)
- 댓글 관리 (삭제)
- 신고된 콘텐츠 관리
- 파일 관리

### 8.3. 시스템 설정

**기능:**
- 테넌트 설정
- 게시판 생성/수정/삭제
- 시스템 공지사항 등록
- 시스템 점검 모드

### 8.4. 통계 및 모니터링

**통계 정보:**
- 일일 활성 사용자 (DAU)
- 월간 활성 사용자 (MAU)
- 신규 가입자 수
- 게시글 작성 수
- 메시지 전송 수
- 파일 업로드 용량

**대시보드:**
- 실시간 접속자 수
- 서버 상태
- 에러 로그
- 성능 메트릭

---

## 9. 기능별 권한

### 9.1. 권한 레벨

| 권한 | 설명 | 기능 |
|------|------|------|
| GUEST | 게스트 | 공개 게시글 조회만 가능 |
| USER | 일반 사용자 | 기본 기능 사용 |
| MODERATOR | 운영자 | 콘텐츠 관리 권한 |
| ADMIN | 관리자 | 모든 권한 |
| SUPER_ADMIN | 최고 관리자 | 시스템 설정 권한 |

### 9.2. 기능별 접근 권한

| 기능 | GUEST | USER | MODERATOR | ADMIN | SUPER_ADMIN |
|------|-------|------|-----------|-------|-------------|
| 게시글 조회 | ✓ | ✓ | ✓ | ✓ | ✓ |
| 게시글 작성 | ✗ | ✓ | ✓ | ✓ | ✓ |
| 댓글 작성 | ✗ | ✓ | ✓ | ✓ | ✓ |
| 메시지 전송 | ✗ | ✓ | ✓ | ✓ | ✓ |
| 파일 업로드 | ✗ | ✓ | ✓ | ✓ | ✓ |
| 게시글 삭제 (타인) | ✗ | ✗ | ✓ | ✓ | ✓ |
| 사용자 관리 | ✗ | ✗ | ✗ | ✓ | ✓ |
| 시스템 설정 | ✗ | ✗ | ✗ | ✗ | ✓ |

---

**작성자:** ROIMSG Development Team  
**최종 수정일:** 2025-10-14  
**버전:** 1.0.0

